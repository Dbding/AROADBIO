<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>農路生態友善工法決策系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- html2canvas & jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body class="bg-zinc-100 text-zinc-900 antialiased">

<div class="max-w-5xl mx-auto p-6 space-y-8">

  <!-- Header -->
  <header class="bg-slate-950 text-white rounded-3xl p-8 shadow-xl">
    <h1 class="text-2xl font-black">農路生態友善工法決策系統</h1>
    <p class="text-slate-400 text-sm font-bold tracking-widest mt-1">
      Byte Apple AI Eco-System · GitHub Pages
    </p>
  </header>

  <!-- API Key 區 -->
  <section class="bg-white rounded-3xl p-6 shadow border space-y-2">
    <label class="font-black text-sm text-slate-700">Gemini API Key</label>

    <input
      id="apiKeyInput"
      type="password"
      placeholder="請貼上你自己的 Gemini API Key"
      class="w-full rounded-xl border border-zinc-300 px-4 py-3 font-mono text-sm"
    />

    <!-- API 說明 + tooltip -->
<div class="flex-1 lg:flex-none relative">
  <label class="block text-[10px] font-black uppercase tracking-[0.3em] text-slate-400 mb-2 flex items-center gap-2">
    Gemini API Key

    <!-- API 說明按鈕 -->
    <button id="apiHelpBtn"
      type="button"
      class="w-4 h-4 rounded-full border border-slate-500 text-slate-400 text-[10px] leading-none hover:bg-slate-700">
      ⓘ
    </button>
  </label>

  <input id="apiKeyInput" type="password" placeholder="貼上 API Key"
    class="w-full lg:w-[360px] rounded-xl px-4 py-3 bg-slate-900 border border-slate-800 text-white font-bold outline-none focus:ring-2 focus:ring-emerald-500" />

  <!-- API 未填灰色提示 -->
  <div id="apiHint"
    class="hidden mt-2 rounded-lg bg-zinc-800/60 border border-zinc-700 px-3 py-2 text-[11px] font-bold text-zinc-400">
    尚未設定 API Key，分析功能將停用（畫面仍可操作）
  </div>

  <!-- API 說明浮出卡片 -->
  <div id="apiHelpCard"
    class="hidden absolute z-50 mt-2 w-72 rounded-xl border border-slate-700 bg-slate-900 p-4 text-xs text-slate-300 shadow-2xl">
    <p class="mb-2">
      本系統需使用 <span class="text-white font-black">使用者自行提供</span> 的 Gemini API Key。
    </p>
    <p class="text-slate-400">
      API 僅於本機瀏覽器中即時呼叫，不會被儲存或回傳至伺服器。
    </p>
  </div>
</div>
  </section>

  <!-- 圖片上傳 -->
  <section class="bg-white rounded-3xl p-6 shadow border space-y-4">
    <h2 class="font-black text-lg">影像上傳（最多 3 張）</h2>

    <input
      id="imageInput"
      type="file"
      accept="image/*"
      multiple
      class="block"
    />

    <div id="preview" class="grid grid-cols-3 gap-4"></div>

    <button
      id="analyzeBtn"
      disabled
      class="w-full rounded-2xl py-4 font-black text-white bg-slate-400 cursor-not-allowed"
    >
      執行診斷（需 API）
    </button>
  </section>

  <!-- 結果 -->
  <section
    id="result"
    class="hidden bg-white rounded-3xl p-6 shadow border space-y-4"
  >
    <h2 class="font-black text-lg">診斷結果（示意）</h2>
    <p class="font-bold text-slate-700">
      此為 GitHub Pages 靜態展示版本，實際分析需有效 API。
    </p>

    <button
      id="pdfBtn"
      class="rounded-xl bg-emerald-600 text-white px-5 py-3 font-black"
    >
      匯出 PDF
    </button>
  </section>

</div>

<script>
  lucide.createIcons();

  const apiKeyInput = document.getElementById("apiKeyInput");
  const apiHint = document.getElementById("apiHint");
  const analyzeBtn = document.getElementById("analyzeBtn");

  const apiHelpBtn = document.getElementById("apiHelpBtn");
  const apiHelpCard = document.getElementById("apiHelpCard");

  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("preview");
  const result = document.getElementById("result");
  const pdfBtn = document.getElementById("pdfBtn");

  /* API Key 偵測 */
  function checkApiKey() {
    const hasKey = apiKeyInput.value.trim().length > 10;
    apiHint.classList.toggle("hidden", hasKey);
    analyzeBtn.disabled = !hasKey;
    analyzeBtn.className = hasKey
      ? "w-full rounded-2xl py-4 font-black text-white bg-emerald-700 hover:bg-emerald-600"
      : "w-full rounded-2xl py-4 font-black text-white bg-slate-400 cursor-not-allowed";
  }
  apiKeyInput.addEventListener("input", checkApiKey);
  checkApiKey();
/** ========= API Key UI ========= **/
const apiHelpBtn = document.getElementById("apiHelpBtn");
const apiHelpCard = document.getElementById("apiHelpCard");
const apiHint = document.getElementById("apiHint");
const apiInput = document.getElementById("apiKeyInput");

function updateApiUI() {
  const hasKey = apiInput.value.trim().length > 10;
  apiHint.classList.toggle("hidden", hasKey);
}

apiInput.addEventListener("input", updateApiUI);
updateApiUI();

// Tooltip 開關
apiHelpBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  apiHelpCard.classList.toggle("hidden");
});

// 點外關閉
document.addEventListener("click", () => {
  apiHelpCard.classList.add("hidden");
});
  /* API Tooltip */
  apiHelpBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    apiHelpCard.classList.toggle("hidden");
  });
  document.addEventListener("click", () => apiHelpCard.classList.add("hidden"));

  /* 圖片預覽 */
  imageInput.addEventListener("change", () => {
    preview.innerHTML = "";
    [...imageInput.files].slice(0, 3).forEach((file) => {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.className = "rounded-xl border";
      preview.appendChild(img);
    });
  });

  /* 偽分析 */
  analyzeBtn.addEventListener("click", () => {
    result.classList.remove("hidden");
    result.scrollIntoView({ behavior: "smooth" });
  });

  /* PDF 匯出 */
  pdfBtn.addEventListener("click", async () => {
    const { jsPDF } = window.jspdf;
    const canvas = await html2canvas(result);
    const pdf = new jsPDF();
    pdf.addImage(canvas, "PNG", 10, 10, 190, 0);
    pdf.save("demo.pdf");
  });
</script>

</body>
</html>

